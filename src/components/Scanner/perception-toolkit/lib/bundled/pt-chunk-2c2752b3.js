/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

perceptionToolkitLoader("./pt-chunk-2c2752b3.js",["exports","./pt-chunk-bc29be45.js"],function(t,e){"use strict";const n="\n:host {\n  --baseline: 8px;\n  --height: calc(var(--baseline) * 6);\n  position: relative;\n  display: flex;\n  height: var(--height);\n}\n\nbutton {\n  width: 100%;\n  height: 100%;\n  align-items: center;\n  border: none;\n  background: none;\n  font-size: 15px;\n  color: #888;\n  cursor: pointer;\n  white-space: nowrap;\n  padding: var(--baseline) calc(var(--baseline) * 2);\n}\n\nbutton:focus,\nbutton:hover {\n  color: #222;\n}\n",i="<button></button>";class s extends HTMLElement{constructor(){super(),this.labelInternal=s.DEFAULT_LABEL,this.root=this.attachShadow({mode:"open"})}connectedCallback(){this.root.innerHTML=`<style>${n}</style> ${i}`,this.render()}get label(){return this.labelInternal}set label(t){this.labelInternal=t,this.render()}render(){const t=this.root.querySelector("button");t&&(t.textContent=this.label)}}s.defaultTagName="action-button",s.DEFAULT_LABEL="Button";const a="\n:host {\n  --baseline: 16px;\n  --background: #FFF;\n  --borderRadius: 5px;\n  --color: #333;\n  --fontFamily: 'Arial', 'Helvetica', sans-serif;\n  --padding: calc(var(--baseline) * 2)\n      calc(var(--baseline) * 2)\n      calc(var(--baseline) * 1)\n      calc(var(--baseline) * 2);\n\n  position: relative;\n  display: inline-block;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n  border-radius: var(--borderRadius);\n  font-family: var(--fontFamily);\n  background: var(--background);\n  color: var(--color);\n}\n\n#container {\n  white-space: nowrap;\n}\n\n#container.padded {\n  padding: var(--padding);\n}\n\n#close {\n  width: 24px;\n  height: 24px;\n  background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=);\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  font-size: 0;\n  border: none;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.3s cubic-bezier(0, 0, 0.3, 1);\n}\n\n#close:hover {\n  opacity: 1;\n}\n\nslot::slotted(*) {\n  flex: 1;\n  border-right: 1px solid #CCC;\n}\n\nslot::slotted(*:last-child) {\n  border-right: none;\n}\n\nslot {\n  display: flex;\n  border-top: 1px solid #AAA;\n}\n\n:host(:empty) slot {\n  border: none;\n}\n\n#title {\n  padding: var(--baseline);\n  font-size: 14px;\n  font-weight: 400;\n  margin: 0;\n}\n\n#description {\n  padding: var(--baseline);\n  font-size: 16px;\n  font-weight: 400;\n  min-height: calc(var(--baseline) * 2);\n  margin: 0;\n}\n\n#image {\n  background-color: #111;\n  background-size: cover;\n  background-position: center center;\n  min-width: 300px;\n  min-height: 210px;\n  transition: background-image 1s ease-out;\n}\n",r='\n  <button id="close">Close</button>\n  <div id="container"></div>\n  <div id="slotted-content"><slot></slot></div>\n';class o extends HTMLElement{constructor(){super(),this.fadeDuration=200,this.sandboxAttribute="allow-same-origin",this.srcInternal="",this.root=this.attachShadow({mode:"open"}),this.onClickBound=this.onClick.bind(this)}get src(){return this.srcInternal}set src(t){this.srcInternal=t,this.render()}get width(){return this.widthInternal}set width(t){this.widthInternal=t,this.setDimensions()}get height(){return this.heightInternal}set height(t){this.heightInternal=t,this.setDimensions()}connectedCallback(){this.root.innerHTML=`<style>${a}</style> ${r}`,this.render(),this.setDimensions(),this.addEventListener("click",this.onClickBound)}disconnectedCallback(){this.removeEventListener("click",this.onClickBound)}async close(t=this.fadeDuration){0!==t?(await e.fade(this,{duration:t}),this.remove()):this.remove()}async onClick(t){"close"===(t.path?t.path[0]:t.composedPath()[0]).id&&await this.close()}render(){const t=this.root.querySelector("#container");if(t)if(t.classList.remove("padded"),this.srcIsString(this.src))t.textContent=this.src,t.classList.add("padded");else if(this.srcIsCardData(this.src))this.renderCardData(this.src);else if(this.srcIsUrl(this.src)){const e=document.createElement("iframe");e.src=this.src.toString(),e.setAttribute("sandbox",this.sandboxAttribute),e.style.border="none",e.id="external-content",e.width=(this.width||0).toString(),e.height=(this.height||0).toString(),t.appendChild(e)}else console.warn("Unexpected card content",this.src),t.textContent="Unexpected content",t.classList.add("padded")}renderCardData(t){const e=this.root.querySelector("#container");if(e){if(e.innerHTML="",t.name){const n=document.createElement("h1");n.setAttribute("id","title"),n.textContent=t.name,e.appendChild(n)}if(t.image){const n=document.createElement("div");n.setAttribute("id","image"),n.style.backgroundImage=`url(${t.image})`,e.appendChild(n)}if(t.description){const n=document.createElement("div");n.setAttribute("id","description"),n.textContent=t.description,e.appendChild(n)}}}srcIsString(t){return"string"==typeof t}srcIsCardData(t){return"object"==typeof t&&void 0===t.href}srcIsUrl(t){return"object"==typeof t&&void 0!==t.href}setDimensions(){const t=this.root.querySelector("#container");t&&(this.widthInternal&&(t.style.width=`${this.widthInternal}px`),this.heightInternal&&(t.style.height=`${this.heightInternal}px`))}}o.defaultTagName="data-card";const c="\n:host {\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #333;\n  animation: fadeIn 0.3s cubic-bezier(0, 0, 0.3, 1) forwards;\n  --baseline: 12px;\n}\n\ncanvas {\n  width: 100%;\n  max-width: 100%;\n  max-height: 100%;\n  object-fit: contain;\n  background: #111;\n}\n\n#reticle {\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  position: absolute;\n  opacity: 0;\n  transition: opacity 0.3s cubic-bezier(0, 0, 0.3, 1);\n}\n\n#close {\n  width: calc(var(--baseline) * 3);\n  height: calc(var(--baseline) * 3);\n  background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=);\n  background-color: #FFF;\n  background-position: center center;\n  background-repeat: no-repeat;\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  font-size: 0;\n  border: none;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\n.overlay {\n  position: absolute;\n  bottom: 50px;\n  left: 50%;\n  min-width: 280px;\n  padding: var(--baseline) calc(var(--baseline) * 2);\n  background: rgba(0, 0, 0, 0.5);\n  border-radius: 20px;\n  color: #FFF;\n  transform: translateX(-50%);\n  text-align: center;\n  font-family: Arial, Helvetica, sans-serif;\n}\n",h='<svg id="reticle" viewBox="0 0 133 100"\n    xmlns="http://www.w3.org/2000/svg">\n  <mask id="reticle-cut-out">\n    <rect id="reticle-cut-out-outer" width="133" height="100" x="0" y="0"\n        fill="#FFF" />\n    <rect id="reticle-cut-out-inner" x="24" y="8" width="85" height="85" rx="2"\n        ry="2" fill="#000" />\n  </mask>\n  <rect id="reticle-box" width="133" height="100" x="0" y="0"\n      fill="rgba(0,0,0,0.4)" mask="url(#reticle-cut-out)" />\n</svg>\n<button id="close">Close</button>\n',d="pt.captureframe",l="pt.capturestarted",p="pt.capturestopped",u="pt.captureclose";class g extends HTMLElement{constructor(){super(),this.captureScale=.5,this.captureRate=0,this.capturePng=!1,this.flipped=!1,this.paused=!1,this.root=this.attachShadow({mode:"open"}),this.lastCapture=-1,this.root.innerHTML=`<style>${c}</style> ${h}`,this.root.addEventListener("click",t=>{"close"===(t.path?t.path[0]:t.composedPath()[0]).id&&e.fire(u,this)})}disconnectedCallback(){this.stop()}start(t){if(this.stream)throw new Error("Stream already provided. Stop the capture first.");this.stream=t,this.initElementsIfNecessary();const n=e.clamp(this.captureScale,0),i=this.video,s=t=>{this.video&&this.ctx&&(this.paused||this.ctx.drawImage(this.video,0,0,this.video.videoWidth*n,this.video.videoHeight*n),0!==this.captureRate&&t-this.lastCapture>this.captureRate&&(this.lastCapture=t,this.captureFrame()),requestAnimationFrame(t=>s(t)))};i.muted=!0,i.srcObject=this.stream,i.play(),i.addEventListener("playing",async()=>{if(!this.video||!this.canvas||!this.ctx)return;let t=5,n=!0;for(;n;)t--,await new Promise(t=>requestAnimationFrame(t)),n=t>0&&(0===this.video.videoWidth||0===this.video.videoHeight);if(0===this.video.videoWidth||0===this.video.videoHeight)throw new Error("Video has width or height of 0");this.canvas.width=this.video.videoWidth*this.captureScale,this.canvas.height=this.video.videoHeight*this.captureScale,this.setReticleOrientation(this.canvas.height>this.canvas.width),this.flipped&&(this.ctx.translate(.5*this.canvas.width,0),this.ctx.scale(-1,1),this.ctx.translate(.5*-this.canvas.width,0)),requestAnimationFrame(t=>{s(t),e.fire(l,this)})},{once:!0})}async captureFrame(){if(!this.ctx||!this.canvas)throw new Error("Unable to capture frame");return new Promise(t=>{const n=this.canvas,i=this.ctx;let s;this.capturePng?((s=new Image).src=n.toDataURL("image/png"),s.onload=(()=>{0!==this.captureRate&&e.fire(d,this,{imgData:s}),t(s)})):(s=i.getImageData(0,0,n.width,n.height),0!==this.captureRate&&e.fire(d,this,{imgData:s}),t(s))})}stop(){if(!this.stream||!this.ctx||!this.canvas)return;const t=this.stream.getTracks();for(const e of t)e.stop();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.remove(),this.video=void 0,this.stream=void 0,this.canvas=void 0,this.ctx=void 0,e.fire(p,this)}setReticleOrientation(t){const e=this.root.querySelector("#reticle");if(e){if(t){e.setAttribute("viewBox","0 0 100 133");const t=e.querySelector("#reticle-cut-out-outer"),n=e.querySelector("#reticle-cut-out-inner"),i=e.querySelector("#reticle-box");if(!t||!n||!i)return;t.setAttribute("width","100"),t.setAttribute("height","133"),n.setAttribute("x","8"),n.setAttribute("y","24"),i.setAttribute("width","100"),i.setAttribute("height","133")}e.style.opacity="1"}}initElementsIfNecessary(){if(!this.canvas){if(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("Unable to create canvas context");this.root.appendChild(this.canvas)}this.video||(this.video=document.createElement("video"))}}g.defaultTagName="stream-capture";t.ActionButton=s,t.Card=o,t.StreamCapture=g,t.cameraAccessDenied="pt.cameraaccessdenied",t.captureStopped="pt.capturestopped",t.closeEvent=u,t.frameEvent=d,t.markerChanges="pt.markerchanges",t.markerDetect="pt.markerdetect"});
